{% extends 'manager/base.html' %}

{% block title %}–£–¥–∞–ª–µ–Ω–∏–µ {{ model_name }}{% endblock %}
{% block page_title %}üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ {{ model_name }}{% endblock %}
{% block page_description %}–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏{% endblock %}

{% block content %}
  <div class="data-card">
    {% if has_dependencies %}
    <div class="alert alert-danger">
      <h5><i class="bi bi-exclamation-triangle-fill"></i> –í–Ω–∏–º–∞–Ω–∏–µ! –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏</h5>
      <p>–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö:</p>
      
      <div class="mt-3">
        {% for dep_name, dep_info in dependencies.items %}
        <div class="mb-3 p-3 bg-light rounded">
          <h6 class="mb-2">
            <strong>{{ dep_info.model_verbose }}</strong> 
            <span class="badge bg-danger">{{ dep_info.count }} –∑–∞–ø–∏—Å–µ–π</span>
          </h6>
          <p class="mb-2 text-muted small">
            {% if dep_info.type == 'ReverseForeignKey' %}
              –°–≤—è–∑–∞–Ω–æ —á–µ—Ä–µ–∑ –ø–æ–ª–µ: <code>{{ dep_info.field_name }}</code> –≤ —Ç–∞–±–ª–∏—Ü–µ <code>{{ dep_info.model }}</code>
            {% elif dep_info.type == 'ManyToMany' %}
              –°–≤—è–∑–∞–Ω–æ —á–µ—Ä–µ–∑ ManyToMany: <code>{{ dep_info.field_name }}</code>
            {% else %}
              –°–≤—è–∑–∞–Ω–æ —á–µ—Ä–µ–∑: <code>{{ dep_name }}</code>
            {% endif %}
          </p>
          {% if dep_info.objects %}
          <div class="small">
            <strong>–ü—Ä–∏–º–µ—Ä—ã —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π:</strong>
            <ul class="mb-0 mt-2">
              {% for related_obj in dep_info.objects %}
              <li>{{ related_obj }}</li>
              {% endfor %}
              {% if dep_info.total > 10 %}
              <li class="text-muted">... –∏ –µ—â–µ {{ dep_info.total|add:"-10" }} –∑–∞–ø–∏—Å–µ–π</li>
              {% endif %}
            </ul>
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      
      <div class="mt-3">
        <p class="mb-2"><strong>–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–π—Å—Ç–≤–∏–π:</strong></p>
        <ul>
          <li>–£–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤—Ä—É—á–Ω—É—é</li>
          <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ/–∏–∑–º–µ–Ω–µ–Ω–æ {{ dependencies|length }} —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π)</li>
        </ul>
      </div>
    </div>
    {% else %}
    <div class="alert alert-warning">
      <h5><i class="bi bi-exclamation-triangle"></i> –í–Ω–∏–º–∞–Ω–∏–µ!</h5>
      <p>–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã <strong>{{ model_name }}</strong>. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
    </div>
    {% endif %}

    <div class="mb-4">
      <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø–∏—Å–∏:</h5>
      <div class="bg-light p-3 rounded">
        <p class="mb-0"><strong>ID:</strong> #{{ object.id }}</p>
        <p class="mb-0"><strong>–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ:</strong> {{ object }}</p>
      </div>
    </div>

    <form method="post">
      {% csrf_token %}
      {% if has_dependencies %}
      <div class="mb-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="force_delete" value="true" id="forceDelete">
          <label class="form-check-label" for="forceDelete">
            <strong>–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ</strong> (—É–¥–∞–ª–∏—Ç/–∏–∑–º–µ–Ω–∏—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏)
          </label>
        </div>
      </div>
      {% endif %}
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-manager" style="background: #fee2e2; color: #991b1b;" 
                {% if has_dependencies %}onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç/–∏–∑–º–µ–Ω–∏—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏!');"{% else %}onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?');"{% endif %}>
          <i class="bi bi-trash"></i> {% if has_dependencies %}–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å{% else %}–î–∞, —É–¥–∞–ª–∏—Ç—å{% endif %}
        </button>
        <a href="{% url 'admin_panel_model_list' model_key %}" class="btn btn-manager btn-manager-secondary">
          <i class="bi bi-x-circle"></i> –û—Ç–º–µ–Ω–∞
        </a>
      </div>
    </form>
  </div>
{% endblock %}

