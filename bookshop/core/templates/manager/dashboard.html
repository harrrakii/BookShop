{% extends 'manager/base.html' %}

{% block title %}–î–∞—à–±–æ—Ä–¥{% endblock %}
{% block page_title %}üìä –î–∞—à–±–æ—Ä–¥{% endblock %}
{% block page_description %}–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏{% endblock %}

{% block content %}
  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
  <div class="stats-grid">
    <!-- –ó–∞–∫–∞–∑—ã -->
    <div class="stat-card">
      <div class="stat-card-header">
        <div class="stat-card-title">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
        <div class="stat-card-icon primary">
          <i class="bi bi-cart-check"></i>
        </div>
      </div>
      <div class="stat-card-value">{{ total_orders }}</div>
      <div class="stat-card-change">
        –°–µ–≥–æ–¥–Ω—è: {{ today_orders }} | –ó–∞ –Ω–µ–¥–µ–ª—é: {{ week_orders }} | –ó–∞ –º–µ—Å—è—Ü: {{ month_orders }}
      </div>
    </div>
    
    <!-- –í—ã—Ä—É—á–∫–∞ -->
    <div class="stat-card">
      <div class="stat-card-header">
        <div class="stat-card-title">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
        <div class="stat-card-icon success">
          <i class="bi bi-currency-exchange"></i>
        </div>
      </div>
      <div class="stat-card-value">{{ total_revenue|floatformat:0 }} ‚ÇΩ</div>
      <div class="stat-card-change">
        –°–µ–≥–æ–¥–Ω—è: {{ today_revenue|floatformat:0 }} ‚ÇΩ | –ó–∞ –Ω–µ–¥–µ–ª—é: {{ week_revenue|floatformat:0 }} ‚ÇΩ | –ó–∞ –º–µ—Å—è—Ü: {{ month_revenue|floatformat:0 }} ‚ÇΩ
      </div>
    </div>
    
    <!-- –¢–æ–≤–∞—Ä—ã -->
    <div class="stat-card">
      <div class="stat-card-header">
        <div class="stat-card-title">–¢–æ–≤–∞—Ä—ã</div>
        <div class="stat-card-icon info">
          <i class="bi bi-box-seam"></i>
        </div>
      </div>
      <div class="stat-card-value">{{ total_books|add:total_stationery }}</div>
      <div class="stat-card-change">
        –ö–Ω–∏–≥: {{ total_books }} | –ö–∞–Ω—Ü—Ç–æ–≤–∞—Ä–æ–≤: {{ total_stationery }}
        {% if low_stock_books > 0 or low_stock_stationery > 0 %}
          <span class="text-danger">‚ö† –ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫: {{ low_stock_books|add:low_stock_stationery }}</span>
        {% endif %}
      </div>
    </div>
    
    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
    <div class="stat-card">
      <div class="stat-card-header">
        <div class="stat-card-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
        <div class="stat-card-icon warning">
          <i class="bi bi-people"></i>
        </div>
      </div>
      <div class="stat-card-value">{{ total_users }}</div>
      <div class="stat-card-change">
        –ö–∞—Ä—Ç –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: {{ total_loyalty_cards }} | –û—Ç–∑—ã–≤–æ–≤: {{ total_reviews }}
      </div>
    </div>
  </div>
  
  <div class="row g-4">
    <!-- –ó–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º -->
    <div class="col-lg-6">
      <div class="data-card">
        <div class="data-card-header">
          <h3 class="data-card-title">–ó–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h3>
        </div>
        <table class="table-manager">
          <thead>
            <tr>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
            </tr>
          </thead>
          <tbody>
            {% for stat in orders_by_status %}
              <tr>
                <td>
                  <span class="badge-manager badge-{{ stat.status }}">
                    {{ stat.status|title }}
                  </span>
                </td>
                <td><strong>{{ stat.count }}</strong></td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="2" class="text-center text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- –¢–æ–ø —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class="col-lg-6">
      <div class="data-card">
        <div class="data-card-header">
          <h3 class="data-card-title">–¢–æ–ø-5 –∫–Ω–∏–≥ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º</h3>
        </div>
        {% if top_books %}
          <div class="list-group list-group-flush">
            {% for book in top_books %}
              <div class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ book.title }}</strong>
                  <div class="text-muted small">–ü—Ä–æ–¥–∞–Ω–æ: {{ book.total_sold }} —à—Ç.</div>
                </div>
                <span class="badge badge-manager badge-manager-primary">{{ book.total_sold }}</span>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted text-center py-3">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö</p>
        {% endif %}
      </div>
    </div>
  </div>
  
  <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã -->
  <div class="data-card">
    <div class="data-card-header">
      <h3 class="data-card-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
      <a href="{% url 'manager_orders' %}" class="btn btn-manager btn-manager-primary">
        –í—Å–µ –∑–∞–∫–∞–∑—ã <i class="bi bi-arrow-right"></i>
      </a>
    </div>
    {% if recent_orders %}
      <div class="table-responsive">
        <table class="table-manager">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ö–ª–∏–µ–Ω—Ç</th>
              <th>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è</th>
              <th>–°—É–º–º–∞</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–î–∞—Ç–∞</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            {% for order in recent_orders %}
              <tr>
                <td><strong>#{{ order.id }}</strong></td>
                <td>
                  {{ order.full_name }}
                  <div class="text-muted small">{{ order.email }}</div>
                </td>
                <td>{{ order.get_fulfillment_type_display }}</td>
                <td><strong>{{ order.total_amount }} ‚ÇΩ</strong></td>
                <td>
                  <span class="badge-manager badge-{{ order.status }}">
                    {{ order.get_status_display }}
                  </span>
                </td>
                <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
                <td>
                  <a href="{% url 'manager_order_detail' order.id %}" class="btn btn-sm btn-manager btn-manager-secondary">
                    –î–µ—Ç–∞–ª–∏
                  </a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted text-center py-4">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
    {% endif %}
  </div>
{% endblock %}

