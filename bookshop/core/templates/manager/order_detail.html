{% extends 'manager/base.html' %}

{% block title %}–ó–∞–∫–∞–∑ #{{ order.id }}{% endblock %}
{% block page_title %}üì¶ –ó–∞–∫–∞–∑ #{{ order.id }}{% endblock %}
{% block page_description %}–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ{% endblock %}

{% block content %}
  <div class="row g-4">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="col-lg-8">
      <div class="data-card">
        <div class="data-card-header">
          <h3 class="data-card-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h3>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-6">
            <strong>–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:</strong>
            <form method="post" class="d-inline-block ms-2">
              {% csrf_token %}
              <select name="status" class="form-select form-select-sm d-inline-block" style="width: auto;" onchange="this.form.submit()">
                {% for value, label in status_choices %}
                  <option value="{{ value }}" {% if order.status == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              </select>
            </form>
          </div>
          <div class="col-md-6 text-end">
            <span class="badge-manager badge-{{ order.status }}" style="font-size: 1rem;">
              {{ order.get_status_display }}
            </span>
          </div>
        </div>
        
        <hr>
        
        <div class="row mb-3">
          <div class="col-md-6">
            <strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ order.created_at|date:"d.m.Y H:i" }}
          </div>
          <div class="col-md-6">
            <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> {{ order.updated_at|date:"d.m.Y H:i" }}
          </div>
        </div>
        
        <hr>
        
        <h5 class="mb-3">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h5>
        <div class="row mb-3">
          <div class="col-md-6">
            <p><strong>–§–ò–û:</strong> {{ order.full_name }}</p>
            <p><strong>Email:</strong> {{ order.email }}</p>
            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ order.phone }}</p>
          </div>
          <div class="col-md-6">
            {% if order.user %}
              <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <a href="{% url 'manager_users' %}?q={{ order.user.email }}">{{ order.user.email }}</a></p>
            {% else %}
              <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> –ù–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</p>
            {% endif %}
          </div>
        </div>
        
        <hr>
        
        <h5 class="mb-3">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è:</h5>
        <p><strong>{{ order.get_fulfillment_type_display }}</strong></p>
        {% if order.fulfillment_type == 'delivery' %}
          {% if order.delivery_option %}
            <p><strong>–í–∞—Ä–∏–∞–Ω—Ç –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ order.delivery_option }}</p>
          {% endif %}
          <p><strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ order.delivery_address|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</p>
        {% elif order.fulfillment_type == 'pickup' and order.pickup_point %}
          <p><strong>–ü–í–ó:</strong> {{ order.pickup_point }}</p>
        {% endif %}
        
        {% if order.comment %}
          <hr>
          <h5 class="mb-3">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</h5>
          <p>{{ order.comment }}</p>
        {% endif %}
      </div>
      
      <!-- –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ -->
      <div class="data-card mt-4">
        <div class="data-card-header">
          <h3 class="data-card-title">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h3>
        </div>
        <table class="table-manager">
          <thead>
            <tr>
              <th>–¢–æ–≤–∞—Ä</th>
              <th>–¶–µ–Ω–∞</th>
              <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
              <th>–°—É–º–º–∞</th>
            </tr>
          </thead>
          <tbody>
            {% for item in order.items.all %}
              <tr>
                <td>
                  <strong>{{ item.name }}</strong>
                  <div class="text-muted small">{{ item.product_type|title }}</div>
                </td>
                <td>{{ item.unit_price }} ‚ÇΩ</td>
                <td>{{ item.quantity }}</td>
                <td><strong>{{ item.subtotal }} ‚ÇΩ</strong></td>
              </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr style="background: var(--lavender-blue);">
              <td colspan="3" class="text-end"><strong>–ò—Ç–æ–≥–æ:</strong></td>
              <td><strong style="font-size: 1.2rem;">{{ order.total_amount }} ‚ÇΩ</strong></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="col-lg-4">
      <div class="data-card">
        <div class="data-card-header">
          <h3 class="data-card-title">–î–µ–π—Å—Ç–≤–∏—è</h3>
        </div>
        <div class="d-grid gap-2">
          <a href="{% url 'manager_orders' %}" class="btn btn-manager btn-manager-secondary">
            <i class="bi bi-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É
          </a>
        </div>
      </div>
      
      <div class="data-card mt-4">
        <div class="data-card-header">
          <h3 class="data-card-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–∞</h3>
        </div>
        <div>
          <p><strong>–¢–æ–≤–∞—Ä–æ–≤:</strong> {{ order.items.count }}</p>
          <p><strong>–°—É–º–º–∞:</strong> {{ order.total_amount }} ‚ÇΩ</p>
          <p><strong>–°–æ–∑–¥–∞–Ω:</strong> {{ order.created_at|date:"d.m.Y" }}</p>
          <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ order.get_status_display }}</p>
        </div>
      </div>
    </div>
  </div>
{% endblock %}



