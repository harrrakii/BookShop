{% extends 'manager/base.html' %}

{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏{% endblock %}
{% block page_title %}üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}
{% block page_description %}–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}

{% block content %}
  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="data-card mb-4">
    <form method="get" class="row g-3 align-items-end">
      <div class="col-md-6">
        <label class="form-label">–ü–æ–∏—Å–∫:</label>
        <input type="text" name="q" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ email, –∏–º–µ–Ω–∏, —Ñ–∞–º–∏–ª–∏–∏..." value="{{ search_query }}">
      </div>
      <div class="col-md-3">
        <label class="form-label">–§–∏–ª—å—Ç—Ä:</label>
        <select name="role" class="form-select">
          <option value="">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
          <option value="staff" {% if role_filter == 'staff' %}selected{% endif %}>–ú–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
          <option value="active" {% if role_filter == 'active' %}selected{% endif %}>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
        </select>
      </div>
      <div class="col-md-3">
        <button type="submit" class="btn btn-manager btn-manager-primary w-100">
          <i class="bi bi-search"></i> –ù–∞–π—Ç–∏
        </button>
      </div>
    </form>
  </div>
  
  <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
  <div class="data-card">
    <div class="data-card-header">
      <h3 class="data-card-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ({{ users.count }})</h3>
      <a href="{% url 'admin:core_user_changelist' %}" class="btn btn-manager btn-manager-primary" target="_blank">
        <i class="bi bi-pencil-square"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ
      </a>
    </div>
    
    {% if users %}
      <div class="table-responsive">
        <table class="table-manager">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
              <th>Email</th>
              <th>–§–ò–û</th>
              <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
              <th>–†–æ–ª—å</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</th>
            </tr>
          </thead>
          <tbody>
            {% for user_obj in users %}
              <tr>
                <td><strong>#{{ user_obj.id }}</strong></td>
                <td>
                  {% if user_obj.username %}
                    {{ user_obj.username }}
                  {% else %}
                    <span class="text-muted">‚Äî</span>
                  {% endif %}
                </td>
                <td>{{ user_obj.email }}</td>
                <td>{{ user_obj.get_full_name|default:"‚Äî" }}</td>
                <td>{{ user_obj.phone|default:"‚Äî" }}</td>
                <td>
                  {% if user_obj.is_staff %}
                    <span class="badge-manager badge-manager-primary">–ú–µ–Ω–µ–¥–∂–µ—Ä</span>
                  {% elif user_obj.role %}
                    <span class="badge-manager badge-manager-secondary">{{ user_obj.role.name }}</span>
                  {% else %}
                    <span class="text-muted">‚Äî</span>
                  {% endif %}
                </td>
                <td>
                  {% if user_obj.is_active %}
                    <span class="badge-manager" style="background: #d1fae5; color: #065f46;">–ê–∫—Ç–∏–≤–µ–Ω</span>
                  {% else %}
                    <span class="badge-manager" style="background: #fee2e2; color: #991b1b;">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                  {% endif %}
                </td>
                <td>
                  {% if user_obj.last_login %}
                    {{ user_obj.last_login|date:"d.m.Y H:i" }}
                  {% else %}
                    <span class="text-muted">–ù–∏–∫–æ–≥–¥–∞</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted text-center py-4">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
    {% endif %}
  </div>
{% endblock %}



